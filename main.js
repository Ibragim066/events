(()=>{"use strict";var t={};function e(t,e){const i=t<e,s=t>=e*(e-1),l=t%e==0,n=(t+1)%e==0;return i&&l?"top-left":i&&n?"top-right":s&&l?"bottom-left":s&&n?"bottom-right":i?"top":s?"bottom":l?"left":n?"right":"center"}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var i=t.g.document;if(!e&&i&&(i.currentScript&&(e=i.currentScript.src),!e)){var s=i.getElementsByTagName("script");if(s.length)for(var l=s.length-1;l>-1&&!e;)e=s[l--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();class i{constructor(t){this.elemModal=null,this.eventShowModal=null,this.eventHideModal=null,this.hiding=!1,this.destroyed=!1,this.animationSpeed=200,this.options=t||{},this.createModal(),this.elemModal.addEventListener("click",this.handlerCloseModal.bind(this)),this.eventShowModal=new CustomEvent("show.modalFunc",{detail:this.elemModal}),this.eventHideModal=new CustomEvent("hide.modalFunc",{detail:this.elemModal})}createModal(){this.elemModal=document.createElement("div");let t,e="";if(this.elemModal.classList.add("modalFunc"),t='<div class="modal__backdrop" data-dismiss="modalFunc"><div class="modal__content"><div class="modal__header"><div class="modal__title" data-modalFunc="title">{{title}}</div><span class="modal__btn-close" data-dismiss="modalFunc" title="Закрыть">×</span></div><div class="modal__body" data-modalFunc="content">{{content}}</div>{{footer}}</div></div>'.replace("{{title}}",this.options.title||"Новое окно"),t=t.replace("{{content}}",this.options.content||""),this.options.footerButtons){for(const t of this.options.footerButtons){let i='<button type="button" class="{{button_class}}" data-handler={{button_handler}}>{{button_text}}</button>'.replace("{{button_class}}",t.class);i=i.replace("{{button_handler}}",t.handler),i=i.replace("{{button_text}}",t.text),e+=i}e='<div class="modal__footer">{{buttons}}</div>'.replace("{{buttons}}",e)}t=t.replace("{{footer}}",e),this.elemModal.innerHTML=t,document.body.appendChild(this.elemModal)}show(){this.destroyed||this.hiding||(this.elemModal.classList.add("modal__show"),document.dispatchEvent(this.eventShowModal))}hide(){this.hiding=!0,this.elemModal.classList.remove("modal__show"),this.elemModal.classList.add("modal__hiding"),setTimeout((()=>{this.elemModal.classList.remove("modal__hiding"),this.hiding=!1}),this.animationSpeed),document.dispatchEvent(this.eventHideModal)}handlerCloseModal(t){("modalFunc"===t.target.dataset.dismiss||t.target.dataset.handler)&&this.hide()}destroy(){this.elemModal.parentElement&&this.elemModal.parentElement.removeChild(this.elemModal),this.elemModal.removeEventListener("click",this.handlerCloseModal.bind(this))}setContent(t){this.elemModal.querySelector('[data-modalFunc="content"]').innerHTML=t}setTitle(t){this.elemModal.querySelector('[data-modalFunc="title"]').innerHTML=t}}let s=null;function l(t){const e=function(t){const e=t**2;return Array.from({length:e/8},((t,e)=>8*e)).flatMap((t=>[t,t+1]))}(t);let i;do{i=Math.floor(Math.random()*e.length)}while(e[i]===s);return s=e[i],s}const n={pointer:"pointer",notallowed:"not-allowed",hammer:`url('${t.p+"assets/6dd07f279ae3a4740ad1.png"}'), not-allowed`};class o{constructor(t){this.hitCount=0,this.missCount=0,this.container=t,this.initUI()}initUI(){if(!(this.container instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container.insertAdjacentHTML("afterbegin",`\n    <div class="click-counter">\n        <div>Hit counts: <span class="hit-count">${this.getHitCount()}</span></div>\n        <div>Miss counts: <span class="miss-count">${this.getMissCount()}</span></div>\n    </div>\n    `),this.hitCountEl=this.container.querySelector(".hit-count"),this.missCountEl=this.container.querySelector(".miss-count")}incrementHit(){this.hitCount+=1,this.updateUI()}incrementMiss(){this.missCount+=1,this.updateUI()}updateUI(){this.hitCountEl.textContent=this.getHitCount(),this.missCountEl.textContent=this.getMissCount()}getHitCount(){return this.hitCount}getMissCount(){return this.missCount}reset(){this.missCount=0,this.hitCount=0,this.updateUI()}}const a=new class{constructor(t){this.boardSize=t,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.isModal=!1,this.initModalListener()}bindToDOM(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}initModalListener(){document.addEventListener("click",(t=>{"modalHandlerCancel"===t.target.dataset.handler&&this.currentModal&&(this.currentModal.hide(),this.isModal=!1)}))}drawUi(t){this.checkBinding(),this.container.innerHTML='\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(let t=0;t<this.boardSize**2;t+=1){const i=document.createElement("div");i.classList.add("cell","map-tile",`map-tile-${e(t,this.boardSize)}`),i.addEventListener("mouseenter",(t=>this.onCellEnter(t))),i.addEventListener("mouseleave",(t=>this.onCellLeave(t))),i.addEventListener("click",(t=>this.onCellClick(t))),this.boardEl.appendChild(i)}this.cells=Array.from(this.boardEl.children)}redrawPositions(t){for(const t of this.cells)t.innerHTML="";const e=this.boardEl.children[t],i=document.createElement("div");i.classList.add("character","generic"),e.appendChild(i)}addCellEnterListener(t){this.cellEnterListeners.push(t)}addCellLeaveListener(t){this.cellLeaveListeners.push(t)}addCellClickListener(t){this.cellClickListeners.push(t)}onCellEnter(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((t=>t.call(null,e)))}onCellLeave(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((t=>t.call(null,e)))}onCellClick(t){const e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((t=>t.call(null,e)))}selectCell(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected",`selected-${e}`)}deselectCell(t){const e=this.cells[t];e.classList.remove(...Array.from(e.classList).filter((t=>t.startsWith("selected"))))}hideCellTooltip(t){this.cells[t].title=""}setCursor(t){this.boardEl.style.cursor=t}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}showModalMessage(t,e){this.isModal||(this.isModal=!0,this.showModal(t,e))}showModal(t,e){const s=new i({title:t,content:`&#${e}`,footerButtons:[{class:"btn btn__cancel",text:"Close",handler:"modalHandlerCancel"}]});this.currentModal=s,s.show()}}(4);a.bindToDOM(document.querySelector("#game-container"));const r=new class{constructor(t){this.gamePlay=t,this.indexSelect=null,this.clickCounter=null,this.onCellClick=this.onCellClick.bind(this),this.onCellEnter=this.onCellEnter.bind(this),this.onCellLeave=this.onCellLeave.bind(this)}init(){this.events(),this.gamePlay.drawUi("prairie"),this.clickCounter=new o(document.querySelector("#game-container")),this.showCharacter()}events(){this.gamePlay.addCellEnterListener(this.onCellEnter),this.gamePlay.addCellLeaveListener(this.onCellLeave),this.gamePlay.addCellClickListener(this.onCellClick)}onCellClick(t){this.reactOnClick(t)}onCellEnter(t){this.gamePlay.setCursor(n.hammer),document.querySelector(".selected-generic")&&this.gamePlay.deselectCell(this.indexSelect),this.gamePlay.selectCell(t),this.indexSelect=t}onCellLeave(t){this.gamePlay.hideCellTooltip(t),this.gamePlay.setCursor(n.pointer)}showCharacter(){this.timerId=setInterval((()=>{const t=l(this.gamePlay.boardSize);this.gamePlay.redrawPositions(t)}),1e3),setTimeout((()=>this.resetTimer()),5e5)}resetTimer(){clearInterval(this.timerId)}reactOnClick(t){document.querySelectorAll(".cell")[t].querySelector(".generic")?(this.clickCounter.incrementHit(),this.clickCounter.getHitCount()>=10&&(this.gamePlay.showModalMessage(`You win! Your points are ${this.clickCounter.getHitCount()}`,"127881"),this.reset())):(this.clickCounter.incrementMiss(),this.clickCounter.getMissCount()>=5&&(this.gamePlay.showModalMessage("You lose!","129335"),this.reset()))}reset(){this.clickCounter.reset()}}(a);r.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQ3JDeEYsS0FBS2lHLFNBQVMyQyxpQkFDWCw0QkFBMkI1SSxLQUFLbUosYUFBYTNELGdCQUM5QyxVQUVGeEYsS0FBS2dHLFdBR1BoRyxLQUFLbUosYUFBYXJELGdCQUNkOUYsS0FBS21KLGFBQWExRCxnQkFBa0IsSUFDdEN6RixLQUFLaUcsU0FBUzJDLGlCQUFpQixZQUFhLFVBQzVDNUksS0FBS2dHLFNBR1gsQ0FFQUEsS0FBQUEsR0FDRWhHLEtBQUttSixhQUFhbkQsT0FDcEIsR0ZqRmtDQyxHQUNwQ2dELEVBQVNHLE0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qc19ldmVudHMvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vanNfZXZlbnRzLy4vc3JjL2pzL3V0aWxzL2NhbGNUaWxlVHlwZS5qcyIsIndlYnBhY2s6Ly9qc19ldmVudHMvd2VicGFjay9ydW50aW1lL2dsb2JhbCIsIndlYnBhY2s6Ly9qc19ldmVudHMvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vanNfZXZlbnRzLy4vc3JjL2pzL2NvbXBvbmVudHMvTW9kYWwvTW9kYWwuanMiLCJ3ZWJwYWNrOi8vanNfZXZlbnRzLy4vc3JjL2pzL3V0aWxzL2NyZWF0ZVBvc2l0aW9uLmpzIiwid2VicGFjazovL2pzX2V2ZW50cy8uL3NyYy9qcy9jdXJzb3JzLmpzIiwid2VicGFjazovL2pzX2V2ZW50cy8uL3NyYy9qcy9jb21wb25lbnRzL0NsaWNrQ291bnRlci9DbGlja0NvdW50ZXIuanMiLCJ3ZWJwYWNrOi8vanNfZXZlbnRzLy4vc3JjL2pzL2FwcC5qcyIsIndlYnBhY2s6Ly9qc19ldmVudHMvLi9zcmMvanMvY29tcG9uZW50cy9HYW1lUGxheS9HYW1lUGxheS5qcyIsIndlYnBhY2s6Ly9qc19ldmVudHMvLi9zcmMvanMvY29tcG9uZW50cy9HYW1lQ29udHJvbGxlci9HYW1lQ29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY2FsY1RpbGVUeXBlKGluZGV4LCBib2FyZFNpemUpIHtcbiAgY29uc3QgaXNUb3BSb3cgPSBpbmRleCA8IGJvYXJkU2l6ZTtcbiAgY29uc3QgaXNCb3R0b21Sb3cgPSBpbmRleCA+PSBib2FyZFNpemUgKiAoYm9hcmRTaXplIC0gMSk7XG4gIGNvbnN0IGlzTGVmdENvbHVtbiA9IGluZGV4ICUgYm9hcmRTaXplID09PSAwO1xuICBjb25zdCBpc1JpZ2h0Q29sdW1uID0gKGluZGV4ICsgMSkgJSBib2FyZFNpemUgPT09IDA7XG5cbiAgaWYgKGlzVG9wUm93ICYmIGlzTGVmdENvbHVtbikgcmV0dXJuICd0b3AtbGVmdCc7XG4gIGlmIChpc1RvcFJvdyAmJiBpc1JpZ2h0Q29sdW1uKSByZXR1cm4gJ3RvcC1yaWdodCc7XG4gIGlmIChpc0JvdHRvbVJvdyAmJiBpc0xlZnRDb2x1bW4pIHJldHVybiAnYm90dG9tLWxlZnQnO1xuICBpZiAoaXNCb3R0b21Sb3cgJiYgaXNSaWdodENvbHVtbikgcmV0dXJuICdib3R0b20tcmlnaHQnO1xuICBpZiAoaXNUb3BSb3cpIHJldHVybiAndG9wJztcbiAgaWYgKGlzQm90dG9tUm93KSByZXR1cm4gJ2JvdHRvbSc7XG4gIGlmIChpc0xlZnRDb2x1bW4pIHJldHVybiAnbGVmdCc7XG4gIGlmIChpc1JpZ2h0Q29sdW1uKSByZXR1cm4gJ3JpZ2h0JztcbiAgcmV0dXJuICdjZW50ZXInO1xufVxuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJ2YXIgc2NyaXB0VXJsO1xuaWYgKF9fd2VicGFja19yZXF1aXJlX18uZy5pbXBvcnRTY3JpcHRzKSBzY3JpcHRVcmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcubG9jYXRpb24gKyBcIlwiO1xudmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmRvY3VtZW50O1xuaWYgKCFzY3JpcHRVcmwgJiYgZG9jdW1lbnQpIHtcblx0aWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQpXG5cdFx0c2NyaXB0VXJsID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7XG5cdGlmICghc2NyaXB0VXJsKSB7XG5cdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcblx0XHRpZihzY3JpcHRzLmxlbmd0aCkge1xuXHRcdFx0dmFyIGkgPSBzY3JpcHRzLmxlbmd0aCAtIDE7XG5cdFx0XHR3aGlsZSAoaSA+IC0xICYmICFzY3JpcHRVcmwpIHNjcmlwdFVybCA9IHNjcmlwdHNbaS0tXS5zcmM7XG5cdFx0fVxuXHR9XG59XG4vLyBXaGVuIHN1cHBvcnRpbmcgYnJvd3NlcnMgd2hlcmUgYW4gYXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCB5b3UgbXVzdCBzcGVjaWZ5IGFuIG91dHB1dC5wdWJsaWNQYXRoIG1hbnVhbGx5IHZpYSBjb25maWd1cmF0aW9uXG4vLyBvciBwYXNzIGFuIGVtcHR5IHN0cmluZyAoXCJcIikgYW5kIHNldCB0aGUgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gdmFyaWFibGUgZnJvbSB5b3VyIGNvZGUgdG8gdXNlIHlvdXIgb3duIGxvZ2ljLlxuaWYgKCFzY3JpcHRVcmwpIHRocm93IG5ldyBFcnJvcihcIkF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyXCIpO1xuc2NyaXB0VXJsID0gc2NyaXB0VXJsLnJlcGxhY2UoLyMuKiQvLCBcIlwiKS5yZXBsYWNlKC9cXD8uKiQvLCBcIlwiKS5yZXBsYWNlKC9cXC9bXlxcL10rJC8sIFwiL1wiKTtcbl9fd2VicGFja19yZXF1aXJlX18ucCA9IHNjcmlwdFVybDsiLCIvKiBlc2xpbnQtZGlzYWJsZSBsaW5lYnJlYWstc3R5bGUgKi9cbmltcG9ydCAnLi9tb2RhbC5jc3MnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbCB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLmVsZW1Nb2RhbCA9IG51bGw7XG4gICAgdGhpcy5ldmVudFNob3dNb2RhbCA9IG51bGw7XG4gICAgdGhpcy5ldmVudEhpZGVNb2RhbCA9IG51bGw7XG4gICAgdGhpcy5oaWRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmRlc3Ryb3llZCA9IGZhbHNlO1xuICAgIHRoaXMuYW5pbWF0aW9uU3BlZWQgPSAyMDA7XG5cbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgdGhpcy5jcmVhdGVNb2RhbCgpO1xuICAgIHRoaXMuZWxlbU1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oYW5kbGVyQ2xvc2VNb2RhbC5iaW5kKHRoaXMpKTtcblxuICAgIHRoaXMuZXZlbnRTaG93TW9kYWwgPSBuZXcgQ3VzdG9tRXZlbnQoJ3Nob3cubW9kYWxGdW5jJywge1xuICAgICAgZGV0YWlsOiB0aGlzLmVsZW1Nb2RhbCxcbiAgICB9KTtcbiAgICB0aGlzLmV2ZW50SGlkZU1vZGFsID0gbmV3IEN1c3RvbUV2ZW50KCdoaWRlLm1vZGFsRnVuYycsIHtcbiAgICAgIGRldGFpbDogdGhpcy5lbGVtTW9kYWwsXG4gICAgfSk7XG4gIH1cblxuICBjcmVhdGVNb2RhbCgpIHtcbiAgICB0aGlzLmVsZW1Nb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IG1vZGFsVGVtcGxhdGUgPSAnPGRpdiBjbGFzcz1cIm1vZGFsX19iYWNrZHJvcFwiIGRhdGEtZGlzbWlzcz1cIm1vZGFsRnVuY1wiPjxkaXYgY2xhc3M9XCJtb2RhbF9fY29udGVudFwiPjxkaXYgY2xhc3M9XCJtb2RhbF9faGVhZGVyXCI+PGRpdiBjbGFzcz1cIm1vZGFsX190aXRsZVwiIGRhdGEtbW9kYWxGdW5jPVwidGl0bGVcIj57e3RpdGxlfX08L2Rpdj48c3BhbiBjbGFzcz1cIm1vZGFsX19idG4tY2xvc2VcIiBkYXRhLWRpc21pc3M9XCJtb2RhbEZ1bmNcIiB0aXRsZT1cItCX0LDQutGA0YvRgtGMXCI+w5c8L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz1cIm1vZGFsX19ib2R5XCIgZGF0YS1tb2RhbEZ1bmM9XCJjb250ZW50XCI+e3tjb250ZW50fX08L2Rpdj57e2Zvb3Rlcn19PC9kaXY+PC9kaXY+JztcbiAgICBjb25zdCBtb2RhbEZvb3RlclRlbXBsYXRlID0gJzxkaXYgY2xhc3M9XCJtb2RhbF9fZm9vdGVyXCI+e3tidXR0b25zfX08L2Rpdj4nO1xuICAgIGNvbnN0IG1vZGFsQnV0dG9uVGVtcGxhdGUgPSAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJ7e2J1dHRvbl9jbGFzc319XCIgZGF0YS1oYW5kbGVyPXt7YnV0dG9uX2hhbmRsZXJ9fT57e2J1dHRvbl90ZXh0fX08L2J1dHRvbj4nO1xuICAgIGxldCBtb2RhbEhUTUw7XG4gICAgbGV0IG1vZGFsRm9vdGVySFRNTCA9ICcnO1xuXG4gICAgdGhpcy5lbGVtTW9kYWwuY2xhc3NMaXN0LmFkZCgnbW9kYWxGdW5jJyk7XG4gICAgbW9kYWxIVE1MID0gbW9kYWxUZW1wbGF0ZS5yZXBsYWNlKFxuICAgICAgJ3t7dGl0bGV9fScsXG4gICAgICB0aGlzLm9wdGlvbnMudGl0bGUgfHwgJ9Cd0L7QstC+0LUg0L7QutC90L4nLFxuICAgICk7XG4gICAgbW9kYWxIVE1MID0gbW9kYWxIVE1MLnJlcGxhY2UoJ3t7Y29udGVudH19JywgdGhpcy5vcHRpb25zLmNvbnRlbnQgfHwgJycpO1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZm9vdGVyQnV0dG9ucykge1xuICAgICAgZm9yIChjb25zdCBidXR0b24gb2YgdGhpcy5vcHRpb25zLmZvb3RlckJ1dHRvbnMpIHtcbiAgICAgICAgbGV0IG1vZGFsRm9vdGVyQnV0dG9uID0gbW9kYWxCdXR0b25UZW1wbGF0ZS5yZXBsYWNlKFxuICAgICAgICAgICd7e2J1dHRvbl9jbGFzc319JyxcbiAgICAgICAgICBidXR0b24uY2xhc3MsXG4gICAgICAgICk7XG4gICAgICAgIG1vZGFsRm9vdGVyQnV0dG9uID0gbW9kYWxGb290ZXJCdXR0b24ucmVwbGFjZShcbiAgICAgICAgICAne3tidXR0b25faGFuZGxlcn19JyxcbiAgICAgICAgICBidXR0b24uaGFuZGxlcixcbiAgICAgICAgKTtcbiAgICAgICAgbW9kYWxGb290ZXJCdXR0b24gPSBtb2RhbEZvb3RlckJ1dHRvbi5yZXBsYWNlKFxuICAgICAgICAgICd7e2J1dHRvbl90ZXh0fX0nLFxuICAgICAgICAgIGJ1dHRvbi50ZXh0LFxuICAgICAgICApO1xuICAgICAgICBtb2RhbEZvb3RlckhUTUwgKz0gbW9kYWxGb290ZXJCdXR0b247XG4gICAgICB9XG4gICAgICBtb2RhbEZvb3RlckhUTUwgPSBtb2RhbEZvb3RlclRlbXBsYXRlLnJlcGxhY2UoXG4gICAgICAgICd7e2J1dHRvbnN9fScsXG4gICAgICAgIG1vZGFsRm9vdGVySFRNTCxcbiAgICAgICk7XG4gICAgfVxuICAgIG1vZGFsSFRNTCA9IG1vZGFsSFRNTC5yZXBsYWNlKCd7e2Zvb3Rlcn19JywgbW9kYWxGb290ZXJIVE1MKTtcbiAgICB0aGlzLmVsZW1Nb2RhbC5pbm5lckhUTUwgPSBtb2RhbEhUTUw7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmVsZW1Nb2RhbCk7XG4gIH1cblxuICBzaG93KCkge1xuICAgIGlmICghdGhpcy5kZXN0cm95ZWQgJiYgIXRoaXMuaGlkaW5nKSB7XG4gICAgICB0aGlzLmVsZW1Nb2RhbC5jbGFzc0xpc3QuYWRkKCdtb2RhbF9fc2hvdycpO1xuICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCh0aGlzLmV2ZW50U2hvd01vZGFsKTtcbiAgICB9XG4gIH1cblxuICBoaWRlKCkge1xuICAgIHRoaXMuaGlkaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmVsZW1Nb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9fc2hvdycpO1xuICAgIHRoaXMuZWxlbU1vZGFsLmNsYXNzTGlzdC5hZGQoJ21vZGFsX19oaWRpbmcnKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuZWxlbU1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsX19oaWRpbmcnKTtcbiAgICAgIHRoaXMuaGlkaW5nID0gZmFsc2U7XG4gICAgfSwgdGhpcy5hbmltYXRpb25TcGVlZCk7XG4gICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCh0aGlzLmV2ZW50SGlkZU1vZGFsKTtcbiAgfVxuXG4gIGhhbmRsZXJDbG9zZU1vZGFsKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuZGF0YXNldC5kaXNtaXNzID09PSAnbW9kYWxGdW5jJyB8fCBlLnRhcmdldC5kYXRhc2V0LmhhbmRsZXIpIHtcbiAgICAgIHRoaXMuaGlkZSgpO1xuICAgIH1cbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuZWxlbU1vZGFsLnBhcmVudEVsZW1lbnQpIHtcbiAgICAgIHRoaXMuZWxlbU1vZGFsLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5lbGVtTW9kYWwpO1xuICAgIH1cbiAgICB0aGlzLmVsZW1Nb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgJ2NsaWNrJyxcbiAgICAgIHRoaXMuaGFuZGxlckNsb3NlTW9kYWwuYmluZCh0aGlzKSxcbiAgICApO1xuICB9XG5cbiAgc2V0Q29udGVudChodG1sKSB7XG4gICAgdGhpcy5lbGVtTW9kYWwucXVlcnlTZWxlY3RvcignW2RhdGEtbW9kYWxGdW5jPVwiY29udGVudFwiXScpLmlubmVySFRNTCA9IGh0bWw7XG4gIH1cblxuICBzZXRUaXRsZSh0ZXh0KSB7XG4gICAgdGhpcy5lbGVtTW9kYWwucXVlcnlTZWxlY3RvcignW2RhdGEtbW9kYWxGdW5jPVwidGl0bGVcIl0nKS5pbm5lckhUTUwgPSB0ZXh0O1xuICB9XG59XG4iLCJsZXQgbGFzdFBvc2l0aW9uID0gbnVsbDtcblxuZnVuY3Rpb24gY3JlYXRlQXJyYXlQb3NpdGlvbnMoYm9hcmRTaXplKSB7XG4gIGNvbnN0IHRvdGFsQ2VsbHMgPSBib2FyZFNpemUgKiogMjtcbiAgcmV0dXJuIEFycmF5LmZyb20oeyBsZW5ndGg6IHRvdGFsQ2VsbHMgLyA4IH0sIChfLCBpKSA9PiBpICogOCkuZmxhdE1hcChcbiAgICAoY2VsbCkgPT4gW2NlbGwsIGNlbGwgKyAxXSxcbiAgKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb24oYm9hcmRTaXplKSB7XG4gIGNvbnN0IGNlbGxzID0gY3JlYXRlQXJyYXlQb3NpdGlvbnMoYm9hcmRTaXplKTtcbiAgbGV0IHJhbmQ7XG5cbiAgZG8ge1xuICAgIHJhbmQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjZWxscy5sZW5ndGgpO1xuICB9IHdoaWxlIChjZWxsc1tyYW5kXSA9PT0gbGFzdFBvc2l0aW9uKTtcblxuICBsYXN0UG9zaXRpb24gPSBjZWxsc1tyYW5kXTtcbiAgcmV0dXJuIGxhc3RQb3NpdGlvbjtcbn1cbiIsImltcG9ydCBoYW1tZXJJbWcgZnJvbSAnLi4vaW1nL2hhbW1lcl9zbWFsbC5wbmcnO1xuXG5jb25zdCBjdXJzb3JzID0ge1xuICBwb2ludGVyOiAncG9pbnRlcicsXG4gIG5vdGFsbG93ZWQ6ICdub3QtYWxsb3dlZCcsXG4gIGhhbW1lcjogYHVybCgnJHtoYW1tZXJJbWd9JyksIG5vdC1hbGxvd2VkYCxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGN1cnNvcnM7XG4iLCJpbXBvcnQgJy4vY2xpY2stY291bnRlci5jc3MnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDbGlja0NvdW50ZXIge1xuICBjb25zdHJ1Y3Rvcihjb250YWluZXIpIHtcbiAgICB0aGlzLmhpdENvdW50ID0gMDtcbiAgICB0aGlzLm1pc3NDb3VudCA9IDA7XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG5cbiAgICB0aGlzLmluaXRVSSgpO1xuICB9XG5cbiAgaW5pdFVJKCkge1xuICAgIGlmICghKHRoaXMuY29udGFpbmVyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbnRhaW5lciBpcyBub3QgSFRNTEVsZW1lbnQnKTtcbiAgICB9XG5cbiAgICB0aGlzLmNvbnRhaW5lci5pbnNlcnRBZGphY2VudEhUTUwoXG4gICAgICAnYWZ0ZXJiZWdpbicsXG4gICAgICBgXG4gICAgPGRpdiBjbGFzcz1cImNsaWNrLWNvdW50ZXJcIj5cbiAgICAgICAgPGRpdj5IaXQgY291bnRzOiA8c3BhbiBjbGFzcz1cImhpdC1jb3VudFwiPiR7dGhpcy5nZXRIaXRDb3VudCgpfTwvc3Bhbj48L2Rpdj5cbiAgICAgICAgPGRpdj5NaXNzIGNvdW50czogPHNwYW4gY2xhc3M9XCJtaXNzLWNvdW50XCI+JHt0aGlzLmdldE1pc3NDb3VudCgpfTwvc3Bhbj48L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICBgLFxuICAgICk7XG4gICAgdGhpcy5oaXRDb3VudEVsID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcignLmhpdC1jb3VudCcpO1xuICAgIHRoaXMubWlzc0NvdW50RWwgPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcubWlzcy1jb3VudCcpO1xuICB9XG5cbiAgaW5jcmVtZW50SGl0KCkge1xuICAgIHRoaXMuaGl0Q291bnQgKz0gMTtcbiAgICB0aGlzLnVwZGF0ZVVJKCk7XG4gIH1cblxuICBpbmNyZW1lbnRNaXNzKCkge1xuICAgIHRoaXMubWlzc0NvdW50ICs9IDE7XG4gICAgdGhpcy51cGRhdGVVSSgpO1xuICB9XG5cbiAgdXBkYXRlVUkoKSB7XG4gICAgdGhpcy5oaXRDb3VudEVsLnRleHRDb250ZW50ID0gdGhpcy5nZXRIaXRDb3VudCgpO1xuICAgIHRoaXMubWlzc0NvdW50RWwudGV4dENvbnRlbnQgPSB0aGlzLmdldE1pc3NDb3VudCgpO1xuICB9XG5cbiAgZ2V0SGl0Q291bnQoKSB7XG4gICAgcmV0dXJuIHRoaXMuaGl0Q291bnQ7XG4gIH1cblxuICBnZXRNaXNzQ291bnQoKSB7XG4gICAgcmV0dXJuIHRoaXMubWlzc0NvdW50O1xuICB9XG5cbiAgcmVzZXQoKSB7XG4gICAgdGhpcy5taXNzQ291bnQgPSAwO1xuICAgIHRoaXMuaGl0Q291bnQgPSAwO1xuICAgIHRoaXMudXBkYXRlVUkoKTtcbiAgfVxufVxuIiwiaW1wb3J0IEdhbWVQbGF5IGZyb20gJy4vY29tcG9uZW50cy9HYW1lUGxheS9HYW1lUGxheSc7XG5pbXBvcnQgR2FtZUNvbnRyb2xsZXIgZnJvbSAnLi9jb21wb25lbnRzL0dhbWVDb250cm9sbGVyL0dhbWVDb250cm9sbGVyJztcblxuY29uc3QgZ2FtZVBsYXkgPSBuZXcgR2FtZVBsYXkoNCk7XG5nYW1lUGxheS5iaW5kVG9ET00oZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dhbWUtY29udGFpbmVyJykpO1xuXG5jb25zdCBnYW1lQ3RybCA9IG5ldyBHYW1lQ29udHJvbGxlcihnYW1lUGxheSk7XG5nYW1lQ3RybC5pbml0KCk7XG4iLCJpbXBvcnQgY2FsY1RpbGVUeXBlIGZyb20gJy4uLy4uL3V0aWxzL2NhbGNUaWxlVHlwZSc7XG5pbXBvcnQgTW9kYWwgZnJvbSAnLi4vTW9kYWwvTW9kYWwnO1xuXG5pbXBvcnQgJy4vZ2FtZS1wbGF5LmNzcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVQbGF5IHtcbiAgY29uc3RydWN0b3IoYm9hcmRTaXplKSB7XG4gICAgdGhpcy5ib2FyZFNpemUgPSBib2FyZFNpemU7XG4gICAgdGhpcy5jb250YWluZXIgPSBudWxsO1xuICAgIHRoaXMuYm9hcmRFbCA9IG51bGw7XG4gICAgdGhpcy5jZWxscyA9IFtdO1xuICAgIHRoaXMuY2VsbENsaWNrTGlzdGVuZXJzID0gW107XG4gICAgdGhpcy5jZWxsRW50ZXJMaXN0ZW5lcnMgPSBbXTtcbiAgICB0aGlzLmNlbGxMZWF2ZUxpc3RlbmVycyA9IFtdO1xuICAgIHRoaXMuaXNNb2RhbCA9IGZhbHNlO1xuXG4gICAgdGhpcy5pbml0TW9kYWxMaXN0ZW5lcigpO1xuICB9XG5cbiAgYmluZFRvRE9NKGNvbnRhaW5lcikge1xuICAgIGlmICghKGNvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb250YWluZXIgaXMgbm90IEhUTUxFbGVtZW50Jyk7XG4gICAgfVxuICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICB9XG5cbiAgaW5pdE1vZGFsTGlzdGVuZXIoKSB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBlLnRhcmdldC5kYXRhc2V0LmhhbmRsZXIgPT09ICdtb2RhbEhhbmRsZXJDYW5jZWwnXG4gICAgICAgICAgICAgICAgJiYgdGhpcy5jdXJyZW50TW9kYWxcbiAgICAgICkge1xuICAgICAgICB0aGlzLmN1cnJlbnRNb2RhbC5oaWRlKCk7XG4gICAgICAgIHRoaXMuaXNNb2RhbCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZHJhd1VpKHRoZW1lKSB7XG4gICAgdGhpcy5jaGVja0JpbmRpbmcoKTtcblxuICAgIHRoaXMuY29udGFpbmVyLmlubmVySFRNTCA9IGBcbiAgICAgIDxkaXYgY2xhc3M9XCJib2FyZC1jb250YWluZXJcIj5cbiAgICAgICAgPGRpdiBkYXRhLWlkPVwiYm9hcmRcIiBjbGFzcz1cImJvYXJkXCI+PC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgdGhpcy5ib2FyZEVsID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcignW2RhdGEtaWQ9Ym9hcmRdJyk7XG5cbiAgICB0aGlzLmJvYXJkRWwuY2xhc3NMaXN0LmFkZCh0aGVtZSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJvYXJkU2l6ZSAqKiAyOyBpICs9IDEpIHtcbiAgICAgIGNvbnN0IGNlbGxFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgY2VsbEVsLmNsYXNzTGlzdC5hZGQoXG4gICAgICAgICdjZWxsJyxcbiAgICAgICAgJ21hcC10aWxlJyxcbiAgICAgICAgYG1hcC10aWxlLSR7Y2FsY1RpbGVUeXBlKGksIHRoaXMuYm9hcmRTaXplKX1gLFxuICAgICAgKTtcbiAgICAgIGNlbGxFbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKGV2ZW50KSA9PiB0aGlzLm9uQ2VsbEVudGVyKGV2ZW50KSk7XG4gICAgICBjZWxsRWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIChldmVudCkgPT4gdGhpcy5vbkNlbGxMZWF2ZShldmVudCkpO1xuICAgICAgY2VsbEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB0aGlzLm9uQ2VsbENsaWNrKGV2ZW50KSk7XG4gICAgICB0aGlzLmJvYXJkRWwuYXBwZW5kQ2hpbGQoY2VsbEVsKTtcbiAgICB9XG5cbiAgICB0aGlzLmNlbGxzID0gQXJyYXkuZnJvbSh0aGlzLmJvYXJkRWwuY2hpbGRyZW4pO1xuICB9XG5cbiAgcmVkcmF3UG9zaXRpb25zKHBvc2l0aW9uKSB7XG4gICAgZm9yIChjb25zdCBjZWxsIG9mIHRoaXMuY2VsbHMpIHtcbiAgICAgIGNlbGwuaW5uZXJIVE1MID0gJyc7XG4gICAgfVxuXG4gICAgY29uc3QgY2VsbEVsID0gdGhpcy5ib2FyZEVsLmNoaWxkcmVuW3Bvc2l0aW9uXTtcbiAgICBjb25zdCBjaGFyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjaGFyRWwuY2xhc3NMaXN0LmFkZCgnY2hhcmFjdGVyJywgJ2dlbmVyaWMnKTtcblxuICAgIGNlbGxFbC5hcHBlbmRDaGlsZChjaGFyRWwpO1xuICB9XG5cbiAgYWRkQ2VsbEVudGVyTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgICB0aGlzLmNlbGxFbnRlckxpc3RlbmVycy5wdXNoKGNhbGxiYWNrKTtcbiAgfVxuXG4gIGFkZENlbGxMZWF2ZUxpc3RlbmVyKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5jZWxsTGVhdmVMaXN0ZW5lcnMucHVzaChjYWxsYmFjayk7XG4gIH1cblxuICBhZGRDZWxsQ2xpY2tMaXN0ZW5lcihjYWxsYmFjaykge1xuICAgIHRoaXMuY2VsbENsaWNrTGlzdGVuZXJzLnB1c2goY2FsbGJhY2spO1xuICB9XG5cbiAgb25DZWxsRW50ZXIoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jZWxscy5pbmRleE9mKGV2ZW50LmN1cnJlbnRUYXJnZXQpO1xuICAgIHRoaXMuY2VsbEVudGVyTGlzdGVuZXJzLmZvckVhY2goKG8pID0+IG8uY2FsbChudWxsLCBpbmRleCkpO1xuICB9XG5cbiAgb25DZWxsTGVhdmUoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jZWxscy5pbmRleE9mKGV2ZW50LmN1cnJlbnRUYXJnZXQpO1xuICAgIHRoaXMuY2VsbExlYXZlTGlzdGVuZXJzLmZvckVhY2goKG8pID0+IG8uY2FsbChudWxsLCBpbmRleCkpO1xuICB9XG5cbiAgb25DZWxsQ2xpY2soZXZlbnQpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY2VsbHMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICB0aGlzLmNlbGxDbGlja0xpc3RlbmVycy5mb3JFYWNoKChvKSA9PiBvLmNhbGwobnVsbCwgaW5kZXgpKTtcbiAgfVxuXG4gIHNlbGVjdENlbGwoaW5kZXgsIGNvbG9yID0gJ3llbGxvdycpIHtcbiAgICB0aGlzLmRlc2VsZWN0Q2VsbChpbmRleCk7XG4gICAgdGhpcy5jZWxsc1tpbmRleF0uY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnLCBgc2VsZWN0ZWQtJHtjb2xvcn1gKTtcbiAgfVxuXG4gIGRlc2VsZWN0Q2VsbChpbmRleCkge1xuICAgIGNvbnN0IGNlbGwgPSB0aGlzLmNlbGxzW2luZGV4XTtcbiAgICBjZWxsLmNsYXNzTGlzdC5yZW1vdmUoXG4gICAgICAuLi5BcnJheS5mcm9tKGNlbGwuY2xhc3NMaXN0KS5maWx0ZXIoKG8pID0+IG8uc3RhcnRzV2l0aCgnc2VsZWN0ZWQnKSksXG4gICAgKTtcbiAgfVxuXG4gIGhpZGVDZWxsVG9vbHRpcChpbmRleCkge1xuICAgIHRoaXMuY2VsbHNbaW5kZXhdLnRpdGxlID0gJyc7XG4gIH1cblxuICBzZXRDdXJzb3IoY3Vyc29yKSB7XG4gICAgdGhpcy5ib2FyZEVsLnN0eWxlLmN1cnNvciA9IGN1cnNvcjtcbiAgfVxuXG4gIGNoZWNrQmluZGluZygpIHtcbiAgICBpZiAodGhpcy5jb250YWluZXIgPT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignR2FtZVBsYXkgbm90IGJpbmQgdG8gRE9NJyk7XG4gICAgfVxuICB9XG5cbiAgc2hvd01vZGFsTWVzc2FnZShtZXNzYWdlLCB1bmljb2RlKSB7XG4gICAgaWYgKCF0aGlzLmlzTW9kYWwpIHtcbiAgICAgIHRoaXMuaXNNb2RhbCA9IHRydWU7XG4gICAgICB0aGlzLnNob3dNb2RhbChtZXNzYWdlLCB1bmljb2RlKTtcbiAgICB9XG4gIH1cblxuICBzaG93TW9kYWwobWVzc2FnZSwgdW5pY29kZSkge1xuICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGFsKHtcbiAgICAgIHRpdGxlOiBtZXNzYWdlLFxuICAgICAgY29udGVudDogYCYjJHt1bmljb2RlfWAsXG4gICAgICBmb290ZXJCdXR0b25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBjbGFzczogJ2J0biBidG5fX2NhbmNlbCcsXG4gICAgICAgICAgdGV4dDogJ0Nsb3NlJyxcbiAgICAgICAgICBoYW5kbGVyOiAnbW9kYWxIYW5kbGVyQ2FuY2VsJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmN1cnJlbnRNb2RhbCA9IG1vZGFsO1xuXG4gICAgbW9kYWwuc2hvdygpO1xuICB9XG59XG4iLCJpbXBvcnQgY3JlYXRlUG9zaXRpb24gZnJvbSAnLi4vLi4vdXRpbHMvY3JlYXRlUG9zaXRpb24nO1xuaW1wb3J0IGN1cnNvcnMgZnJvbSAnLi4vLi4vY3Vyc29ycyc7XG5pbXBvcnQgQ2xpY2tDb3VudGVyIGZyb20gJy4uL0NsaWNrQ291bnRlci9DbGlja0NvdW50ZXInO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHYW1lQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKGdhbWVQbGF5KSB7XG4gICAgdGhpcy5nYW1lUGxheSA9IGdhbWVQbGF5O1xuICAgIHRoaXMuaW5kZXhTZWxlY3QgPSBudWxsO1xuICAgIHRoaXMuY2xpY2tDb3VudGVyID0gbnVsbDtcbiAgICB0aGlzLm9uQ2VsbENsaWNrID0gdGhpcy5vbkNlbGxDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DZWxsRW50ZXIgPSB0aGlzLm9uQ2VsbEVudGVyLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNlbGxMZWF2ZSA9IHRoaXMub25DZWxsTGVhdmUuYmluZCh0aGlzKTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgdGhpcy5ldmVudHMoKTtcbiAgICB0aGlzLmdhbWVQbGF5LmRyYXdVaSgncHJhaXJpZScpO1xuICAgIHRoaXMuY2xpY2tDb3VudGVyID0gbmV3IENsaWNrQ291bnRlcihcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnYW1lLWNvbnRhaW5lcicpLFxuICAgICk7XG4gICAgdGhpcy5zaG93Q2hhcmFjdGVyKCk7XG4gIH1cblxuICBldmVudHMoKSB7XG4gICAgdGhpcy5nYW1lUGxheS5hZGRDZWxsRW50ZXJMaXN0ZW5lcih0aGlzLm9uQ2VsbEVudGVyKTtcbiAgICB0aGlzLmdhbWVQbGF5LmFkZENlbGxMZWF2ZUxpc3RlbmVyKHRoaXMub25DZWxsTGVhdmUpO1xuICAgIHRoaXMuZ2FtZVBsYXkuYWRkQ2VsbENsaWNrTGlzdGVuZXIodGhpcy5vbkNlbGxDbGljayk7XG4gIH1cblxuICBvbkNlbGxDbGljayhlKSB7XG4gICAgdGhpcy5yZWFjdE9uQ2xpY2soZSk7XG4gIH1cblxuICBvbkNlbGxFbnRlcihpbmRleCkge1xuICAgIHRoaXMuZ2FtZVBsYXkuc2V0Q3Vyc29yKGN1cnNvcnMuaGFtbWVyKTtcblxuICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VsZWN0ZWQtZ2VuZXJpYycpKSB7XG4gICAgICB0aGlzLmdhbWVQbGF5LmRlc2VsZWN0Q2VsbCh0aGlzLmluZGV4U2VsZWN0KTtcbiAgICB9XG5cbiAgICB0aGlzLmdhbWVQbGF5LnNlbGVjdENlbGwoaW5kZXgpO1xuICAgIHRoaXMuaW5kZXhTZWxlY3QgPSBpbmRleDtcbiAgfVxuXG4gIG9uQ2VsbExlYXZlKGluZGV4KSB7XG4gICAgdGhpcy5nYW1lUGxheS5oaWRlQ2VsbFRvb2x0aXAoaW5kZXgpO1xuICAgIHRoaXMuZ2FtZVBsYXkuc2V0Q3Vyc29yKGN1cnNvcnMucG9pbnRlcik7XG4gIH1cblxuICBzaG93Q2hhcmFjdGVyKCkge1xuICAgIHRoaXMudGltZXJJZCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gY3JlYXRlUG9zaXRpb24odGhpcy5nYW1lUGxheS5ib2FyZFNpemUpO1xuICAgICAgdGhpcy5nYW1lUGxheS5yZWRyYXdQb3NpdGlvbnMocG9zaXRpb24pO1xuICAgIH0sIDEwMDApO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnJlc2V0VGltZXIoKSwgNTAwMDAwKTtcbiAgfVxuXG4gIHJlc2V0VGltZXIoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVySWQpO1xuICB9XG5cbiAgcmVhY3RPbkNsaWNrKGUpIHtcbiAgICBjb25zdCBib2FyZENlbGxDbGljayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJylbZV07XG4gICAgY29uc3QgaXNHb2JsaW4gPSBib2FyZENlbGxDbGljay5xdWVyeVNlbGVjdG9yKCcuZ2VuZXJpYycpO1xuXG4gICAgaWYgKGlzR29ibGluKSB7XG4gICAgICB0aGlzLmNsaWNrQ291bnRlci5pbmNyZW1lbnRIaXQoKTtcblxuICAgICAgaWYgKHRoaXMuY2xpY2tDb3VudGVyLmdldEhpdENvdW50KCkgPj0gMTApIHtcbiAgICAgICAgdGhpcy5nYW1lUGxheS5zaG93TW9kYWxNZXNzYWdlKFxuICAgICAgICAgIGBZb3Ugd2luISBZb3VyIHBvaW50cyBhcmUgJHt0aGlzLmNsaWNrQ291bnRlci5nZXRIaXRDb3VudCgpfWAsXG4gICAgICAgICAgJzEyNzg4MScsXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jbGlja0NvdW50ZXIuaW5jcmVtZW50TWlzcygpO1xuICAgICAgaWYgKHRoaXMuY2xpY2tDb3VudGVyLmdldE1pc3NDb3VudCgpID49IDUpIHtcbiAgICAgICAgdGhpcy5nYW1lUGxheS5zaG93TW9kYWxNZXNzYWdlKCdZb3UgbG9zZSEnLCAnMTI5MzM1Jyk7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXNldCgpIHtcbiAgICB0aGlzLmNsaWNrQ291bnRlci5yZXNldCgpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImNhbGNUaWxlVHlwZSIsImluZGV4IiwiYm9hcmRTaXplIiwiaXNUb3BSb3ciLCJpc0JvdHRvbVJvdyIsImlzTGVmdENvbHVtbiIsImlzUmlnaHRDb2x1bW4iLCJnIiwiZ2xvYmFsVGhpcyIsInRoaXMiLCJGdW5jdGlvbiIsImUiLCJ3aW5kb3ciLCJzY3JpcHRVcmwiLCJpbXBvcnRTY3JpcHRzIiwibG9jYXRpb24iLCJkb2N1bWVudCIsImN1cnJlbnRTY3JpcHQiLCJzcmMiLCJzY3JpcHRzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJsZW5ndGgiLCJpIiwiRXJyb3IiLCJyZXBsYWNlIiwicCIsIk1vZGFsIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwiZWxlbU1vZGFsIiwiZXZlbnRTaG93TW9kYWwiLCJldmVudEhpZGVNb2RhbCIsImhpZGluZyIsImRlc3Ryb3llZCIsImFuaW1hdGlvblNwZWVkIiwiY3JlYXRlTW9kYWwiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlckNsb3NlTW9kYWwiLCJiaW5kIiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJjcmVhdGVFbGVtZW50IiwibW9kYWxIVE1MIiwibW9kYWxGb290ZXJIVE1MIiwiY2xhc3NMaXN0IiwiYWRkIiwidGl0bGUiLCJjb250ZW50IiwiZm9vdGVyQnV0dG9ucyIsImJ1dHRvbiIsIm1vZGFsRm9vdGVyQnV0dG9uIiwiY2xhc3MiLCJoYW5kbGVyIiwidGV4dCIsImlubmVySFRNTCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsInNob3ciLCJkaXNwYXRjaEV2ZW50IiwiaGlkZSIsInJlbW92ZSIsInNldFRpbWVvdXQiLCJ0YXJnZXQiLCJkYXRhc2V0IiwiZGlzbWlzcyIsImRlc3Ryb3kiLCJwYXJlbnRFbGVtZW50IiwicmVtb3ZlQ2hpbGQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2V0Q29udGVudCIsImh0bWwiLCJxdWVyeVNlbGVjdG9yIiwic2V0VGl0bGUiLCJsYXN0UG9zaXRpb24iLCJjcmVhdGVQb3NpdGlvbiIsImNlbGxzIiwidG90YWxDZWxscyIsIkFycmF5IiwiZnJvbSIsIl8iLCJmbGF0TWFwIiwiY2VsbCIsImNyZWF0ZUFycmF5UG9zaXRpb25zIiwicmFuZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInBvaW50ZXIiLCJub3RhbGxvd2VkIiwiaGFtbWVyIiwiQ2xpY2tDb3VudGVyIiwiY29udGFpbmVyIiwiaGl0Q291bnQiLCJtaXNzQ291bnQiLCJpbml0VUkiLCJIVE1MRWxlbWVudCIsImluc2VydEFkamFjZW50SFRNTCIsImdldEhpdENvdW50IiwiZ2V0TWlzc0NvdW50IiwiaGl0Q291bnRFbCIsIm1pc3NDb3VudEVsIiwiaW5jcmVtZW50SGl0IiwidXBkYXRlVUkiLCJpbmNyZW1lbnRNaXNzIiwidGV4dENvbnRlbnQiLCJyZXNldCIsImdhbWVQbGF5IiwiYm9hcmRFbCIsImNlbGxDbGlja0xpc3RlbmVycyIsImNlbGxFbnRlckxpc3RlbmVycyIsImNlbGxMZWF2ZUxpc3RlbmVycyIsImlzTW9kYWwiLCJpbml0TW9kYWxMaXN0ZW5lciIsImJpbmRUb0RPTSIsImN1cnJlbnRNb2RhbCIsImRyYXdVaSIsInRoZW1lIiwiY2hlY2tCaW5kaW5nIiwiY2VsbEVsIiwiZXZlbnQiLCJvbkNlbGxFbnRlciIsIm9uQ2VsbExlYXZlIiwib25DZWxsQ2xpY2siLCJjaGlsZHJlbiIsInJlZHJhd1Bvc2l0aW9ucyIsInBvc2l0aW9uIiwiY2hhckVsIiwiYWRkQ2VsbEVudGVyTGlzdGVuZXIiLCJjYWxsYmFjayIsInB1c2giLCJhZGRDZWxsTGVhdmVMaXN0ZW5lciIsImFkZENlbGxDbGlja0xpc3RlbmVyIiwicHJldmVudERlZmF1bHQiLCJpbmRleE9mIiwiY3VycmVudFRhcmdldCIsImZvckVhY2giLCJvIiwiY2FsbCIsInNlbGVjdENlbGwiLCJjb2xvciIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsImRlc2VsZWN0Q2VsbCIsImZpbHRlciIsInN0YXJ0c1dpdGgiLCJoaWRlQ2VsbFRvb2x0aXAiLCJzZXRDdXJzb3IiLCJjdXJzb3IiLCJzdHlsZSIsInNob3dNb2RhbE1lc3NhZ2UiLCJtZXNzYWdlIiwidW5pY29kZSIsInNob3dNb2RhbCIsIm1vZGFsIiwiZ2FtZUN0cmwiLCJpbmRleFNlbGVjdCIsImNsaWNrQ291bnRlciIsImluaXQiLCJldmVudHMiLCJzaG93Q2hhcmFjdGVyIiwicmVhY3RPbkNsaWNrIiwiY3Vyc29ycyIsInRpbWVySWQiLCJzZXRJbnRlcnZhbCIsInJlc2V0VGltZXIiLCJjbGVhckludGVydmFsIiwicXVlcnlTZWxlY3RvckFsbCJdLCJzb3VyY2VSb290IjoiIn0=